Windows AppLocker
AppLocker, Windows'un bir uygulama beyaz liste (allowlist) whitelist çözümüdür.
Temel amacı, kuruluşunuzdaki bilgisayarlarda yalnızca yetkili yazılımların çalışmasına izin vermek, yetkisiz yazılımları, betikleri, yükleyicileri ve DLL'leri engellemektir.
Güvenlik politikalarınızı merkezi olarak (GPO ile) yönetmenizi sağlar.

Geleneksel yazılım kısıtlama politikalarından (SRP) çok daha esnek, yönetilebilir ve güçlüdür. AppLocker, SRP’nin gelişmiş versiyonudur (Win7’den sonra tavsiye edilen AppLocker’dır).

**Amaç: “Sadece izin verilenler çalışır” prensibini uygular. → yani whitelist mantığı ile çalışır.


1: “Computer Configuration – Policies – Windows Settings – Security Settings – Application Control” altında “AppLocker”
2: “Computer Configuration – Policies – Windows Settings – Security Settings – System Services” altında “Application Identity” 


Çalışma Mimarisi ve Kuralları:

AppLocker'ın çalışma mantığı, kurallara dayanır. Bu kurallar, çalışmasına izin verilen veya engellenen dosyaları ve uygulamaları tanımlar.
AppLocker, bu kuralları aşağıdaki beş farklı dosya türü için belirlemenize olanak tanır:

Yürütülebilir Dosyalar (.exe, .com): Programların, betiklerin ve diğer çalıştırılabilir dosyaların çalışmasını kontrol eder.
Betik Dosyaları (.ps1, .vbs, .js, .cmd, .bat): PowerShell, VBScript, JavaScript gibi betiklerin çalışmasını yönetir.
Windows Installer Dosyaları (.msi, .msp): Yazılım kurulumlarını ve yamalarını kontrol eder.
Uygulama Paketi Dosyaları (.appx): Windows 8 ve sonrası modern uygulamaların (Universal Windows Platform - UWP) çalışmasını yönetir.
DLL Dosyaları (.dll, .ocx): Uygulamaların ihtiyaç duyduğu dinamik bağlantı kütüphanelerinin (Dynamic Link Libraries) çalışmasını kontrol eder.
Bu dosya türü, diğerlerine göre daha karmaşıktır ve kaynak kullanımı fazladır. Dikkatli bir yapılandırma gerektirir.

Kural Türleri (Rule Types):

Yayıncı (Publisher): Dijital imzaya dayalı (yayıncı adı, ürün adı, dosya adı, sürüm).
Yol (Path): Dosya konumuna göre (örneğin, C:\Program Files altındaki tüm .exe'ler).
Hash: Dosyanın benzersiz parmak izine göre (ancak güncellemelerde manuel güncelleme gerektirir).

Uygulama Modları (Enforcement Modes):
Uygulama Modu (Enforce): Kurallara uymayan uygulamalar bloke edilir. Üretim ortamında kullanılır.
Denetim Modu (Audit Only): Uygulamalar bloke edilmez, sadece olay günlüğüne (event logs) kaydedilir.
Bu mod, politika etkisini test etmek için idealdir – örneğin, hangi uygulamaların kullanıldığını analiz edebilirsiniz.

Default Rules (Mutlaka eklenmeli)
%SystemRoot%\* → Windows sistem dosyaları
%WINDIR%
%SYSTEM32%
%ProgramFiles%\* → Normal uygulamalar
BUILTIN\Administrators → Admin her şeyi çalıştırabilsin

# Best Practices (Şirket Ortamı için Öneriler)

Her zaman Audit ile başla → yanlış kural yazarsan kullanıcıların işi durmaz.
Publisher rule tercih et → Windows Update sonrası bozulmaz. En güvenli ve sürdürülebilir yöntemdir. 
Default Allow Rules eklemeyi unutma → yoksa Windows çalışmaz.
Deny kuralları Allow kurallarından önce değerlendirilir.
Departman bazlı policy oluştur (finans, IT, üretim farklı ihtiyaç duyar).
Uygulama Envanteri çıkar → "Kim ne kullanıyor?" sorusunu loglardan öğren, sonra yasaklama yap.
SRP (Software Restriction Policies) ile karıştırma → AppLocker, SRP’nin gelişmiş versiyonudur (Win7’den sonra tavsiye edilen AppLocker’dır).
AppLocker kurallarının uygulanması için AppIDSvc servisi aktif olmalıdır. Application Identity service her makinede otomatik başlatılmalı.
DLL kuralları varsayılan olarak devre dışıdır, DLL kuralları: Performans maliyeti yüksektir, genellikle sadece yüksek güvenlik ihtiyacı olan senaryolarda açılır.
Tüm domain bilgisayarlarına değil, sadece ilgili OU’lara uygula. (Örn: Satış, Muhasebe, IT)
Policy dağıtımı: GPO ile enforce edilen AppLocker kuralları, lokal AppLocker kurallarını override eder.
-ilk kural yazıldıktan sonra Eğer default allow rules eklenmezse kritik Windows bileşenleri bile çalışmaz.
-ilk olarak whitelist verilmeli ve tüm herşey whitelist olmalı ve izin verilmelidir. daha sonra spesifik blacklist verilmelidir.
Enforcement mode kısmından ise policleyler enable veya log monitoring moda alınmalıdır.


Event Log Yönetimi
Applications and Services Logs → Microsoft → Windows → AppLocker
Event log yolu: Her dosya tipi (EXE and DLL, MSI, Script, Packaged App) için ayrı alt loglar vardır.


Önemli Event ID’ler:
8003, Uygulama izin verildi
8004, Uygulama engellendi
8005, Kural yoksayıldı (önceki kural eşleşti)
8006, Kural oluşturuldu
8007, Kural silindi


Özel Durumlar ( Bilinen Bypass Scenarios)
AppLocker'ın bypass edilebileceği durumları bilin: 

├── InstallUtil.exe (.NET assembly execution)
├── MSBuild.exe (C# code compilation/execution)  
├── Rundll32.exe (DLL function calling)
├── Regsvr32.exe (Scriptlet execution)
├── WMIC.exe (XSL script execution)
└── PowerShell.exe (Various techniques)
---

PS:
# Mevcut policy’yi XML'e aktar
Export-AppLockerPolicy -Xml -FilePath C:\temp\AppLocker.xml

# XML'den policy'i uygula
Set-AppLockerPolicy -XmlPolicy C:\temp\AppLocker.xml

# Policy’in neyi engellediğini göster
Get-AppLockerPolicy -Xml | Select-Xml "//Rule[@Action='Deny']" | ForEach-Object {$_.Node}

https://en.wikipedia.org/wiki/AppLocker